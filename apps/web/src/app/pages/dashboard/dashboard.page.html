<section class="dashboard-page">
  <header class="dashboard-page__header">
    <div>
      <h1 nz-typography>{{ pageTitle }}</h1>
      <p nz-typography nzType="secondary">{{ subtitle }}</p>
    </div>
  </header>

  <main class="dashboard-page__content">
    <nz-card class="dashboard-page__block">
      <app-dashboard-filter-bar
        [value]="filters()"
        [customerOptions]="customerOptions()"
        [isLoading]="customerOptionsLoading()"
        [canFilterByCustomer]="canFilterByCustomer()"
        (filtersChanged)="onFiltersChange($event)"
        (filtersSubmitted)="onFiltersSubmit($event)"
        (filtersReset)="onFiltersReset()"
      />
    </nz-card>

    <nz-divider nzText="KPI"></nz-divider>
    <section class="dashboard-page__block dashboard-page__block--stacked">
      @if (hasKpiError()) {
        <nz-alert
          nzType="error"
          nzMessage="Nie uda≈Ço siƒô pobraƒá KPI"
          nzDescription="Sprawd≈∫ po≈ÇƒÖczenie lub od≈õwie≈º dane."
          nzShowIcon
          class="dashboard-page__alert"
        >
          <ng-template #nzAction>
            <button nz-button nzType="primary" nzSize="small" (click)="onRetryAll()">
              Spr√≥buj ponownie
            </button>
          </ng-template>
        </nz-alert>
      }
      @if (showKpiEmpty()) {
        <app-empty-state
          icon="üìä"
          title="Brak danych KPI"
          description="Brak zam√≥wie≈Ñ w wybranym zakresie dat."
        />
      } @else {
        <app-dashboard-kpi-cards
          [data]="kpiViewModel()"
          [isLoading]="kpiState().isLoading"
          [hasError]="hasKpiError()"
          [showEmpty]="showKpiEmpty()"
        />
      }
    </section>

    <nz-divider nzText="Trend miesiƒôczny"></nz-divider>
    <section class="dashboard-page__block dashboard-page__block--stacked">
      @if (hasTrendError()) {
        <nz-alert
          nzType="error"
          nzMessage="Trend miesiƒôczny jest niedostƒôpny"
          nzDescription="Spr√≥buj od≈õwie≈ºyƒá dane lub zmieniƒá filtry."
          nzShowIcon
          class="dashboard-page__alert"
        >
          <ng-template #nzAction>
            <button nz-button nzType="default" nzSize="small" (click)="onRetryAll()">
              Od≈õwie≈º dane
            </button>
          </ng-template>
        </nz-alert>
      }
      <app-dashboard-trend-bar-chart
        [data]="trendViewModel()"
        [isLoading]="trendState().isLoading"
        [hasError]="hasTrendError()"
        [selectedMonth]="activeMonth()"
        (monthSelect)="onMonthSelect($event)"
        (clearSelection)="onMonthClear()"
        (retry)="onRetryAll()"
      />
    </section>

    <nz-divider nzText="Rozk≈Çad dzienny"></nz-divider>
    <section class="dashboard-page__block">
      <app-dashboard-daily-breakdown
        [selectedMonth]="activeMonth()"
        [data]="dailyViewModel()"
        [isLoading]="dailyState().isLoading"
        [hasError]="hasDailyError()"
        (clear)="onMonthClear()"
        (retry)="onDailyRetry()"
      />
    </section>
  </main>
</section>


