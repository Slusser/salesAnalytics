<section class="orders-page">
  <header class="page-header">
    <h2>Zamówienia</h2>
    <div class="page-header__actions">
      @if (canMutate()) {
        <button
          nz-button
          nzType="primary"
          [disabled]="loading()"
          (click)="onCreate()"
        >
          Dodaj
        </button>
      }
    </div>
  </header>

  <app-orders-toolbar
    [filters]="params()"
    [loading]="loading()"
    [permissions]="permissions()"
    (filtersChange)="onFiltersChange($event)"
    (filtersReset)="onFiltersReset()"
    (includeDeletedToggle)="onIncludeDeletedToggle($event)"
  />

  @if (showError()) {
    <nz-alert
      nzType="error"
      nzMessage="Nie udało się pobrać listy zamówień"
      nzDescription="Spróbuj odświeżyć stronę lub zmień filtry."
      [nzShowIcon]="true"
    >
      <ng-template #nzAction>
        <button nz-button nzType="primary" (click)="onRetry()">
          Spróbuj ponownie
        </button>
      </ng-template>
    </nz-alert>
  }

  @if (showEmpty()) {
    <app-empty-state
      title="Brak zamówień"
      description="Nie znaleziono zamówień dla podanych filtrów."
      actionLabel="Resetuj filtry"
      (action)="onFiltersReset()"
    />
  } @else {
    <app-orders-data-table
      [rows]="items()"
      [sort]="params().sort"
      [loading]="loading()"
      [permissions]="permissions()"
      [expandedRowId]="expandedRowId()"
      (sortChange)="onSortChange($event)"
      (rowToggle)="onRowToggle($event)"
      (edit)="onEdit($event)"
      (softDelete)="onSoftDelete($event)"
      (restore)="onRestore($event)"
    />

    <app-pagination
      [page]="params().page"
      [limit]="params().limit"
      [total]="total()"
      [disabled]="loading()"
      [limitOptions]="[25, 50, 100]"
      (pageChange)="onPageChange($event)"
      (limitChange)="onLimitChange($event)"
    />
  }

  <app-confirm-dialog
    [open]="confirmDialogOpen()"
    [title]="confirmDialogTitle()"
    [description]="confirmDialogDescription()"
    [orderNo]="confirmDialogOrderNo()"
    [loading]="confirmDialogLoading()"
    confirmLabel="Potwierdź"
    cancelLabel="Anuluj"
    (confirmed)="onConfirmDialogConfirm()"
    (closed)="onConfirmDialogClose()"
  />
</section>
